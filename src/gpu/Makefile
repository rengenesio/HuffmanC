OPTIMIZATION = O0
#THREADS = x256
#VERSION = normal
#VERSION = otimizado
VERSION = gpu

CC = gcc
CFLAGS = -Wall -std=gnu99 -$(OPTIMIZATION) -Wpadded
CFLAGS2 = -lpthread

RM = rm


DIR_SRC     = src_$(VERSION)/
DIR_RELEASE = release/$(VERSION)/

DIR_DECODER =  
DIR_ENCODER =  
DIR_TDD	    =  

LIB_HUFFMAN      = huffman.h
SRC_HUFFMAN      = huffman.c
OBJ_HUFFMAN      = huffman$(OPTIMIZATION)$(THREADS).o
PATH_LIB_HUFFMAN = $(DIR_SRC)$(DIR_HUFFMAN)$(LIB_HUFFMAN)
PATH_SRC_HUFFMAN = $(DIR_SRC)$(DIR_HUFFMAN)$(SRC_HUFFMAN)
PATH_OBJ_HUFFMAN = $(DIR_RELEASE)$(DIR_HUFFMAN)$(OBJ_HUFFMAN)

SRC_ENCODER      = encoder.c
EXE_ENCODER      = encoder$(OPTIMIZATION)$(THREADS)
PATH_SRC_ENCODER = $(DIR_SRC)$(DIR_ENCODER)$(SRC_ENCODER)
PATH_EXE_ENCODER = $(DIR_RELEASE)$(DIR_ENCODER)$(EXE_ENCODER)

SRC_DECODER      = decoder.c
EXE_DECODER      = decoder$(OPTIMIZATION)$(THREADS)
PATH_SRC_DECODER = $(DIR_SRC)$(DIR_DECODER)$(SRC_DECODER)
PATH_EXE_DECODER = $(DIR_RELEASE)$(DIR_DECODER)$(EXE_DECODER)

SRC_TDD      = tdd.c
EXE_TDD	     = tdd
PATH_SRC_TDD = $(DIR_SRC)$(DIR_TDD)$(SRC_TDD)
PATH_EXE_TDD = $(DIR_RELEASE)$(DIR_TDD)$(EXE_TDD)


all: $(OBJ_HUFFMAN) $(EXE_ENCODER) $(EXE_DECODER)

$(OBJ_HUFFMAN): $(PATH_OBJ_HUFFMAN) $(PATH_LIB_HUFFMAN)
$(PATH_OBJ_HUFFMAN): $(PATH_SRC_HUFFMAN) $(PATH_LIB_HUFFMAN)
	#$(CC) -c $(PATH_SRC_HUFFMAN) -o $(PATH_OBJ_HUFFMAN) $(CFLAGS) 
	$(CC) -c $(PATH_SRC_HUFFMAN) -o $(PATH_OBJ_HUFFMAN) $(CFLAGS) 

$(EXE_ENCODER): $(PATH_EXE_ENCODER)
$(PATH_EXE_ENCODER): $(PATH_OBJ_HUFFMAN) $(PATH_SRC_ENCODER)
	$(CC) $(PATH_OBJ_HUFFMAN) $(PATH_SRC_ENCODER) -o $(PATH_EXE_ENCODER) $(CFLAGS) $(CFLAGS2)

$(EXE_DECODER): $(PATH_EXE_DECODER) 
$(PATH_EXE_DECODER): $(PATH_OBJ_HUFFMAN) $(PATH_SRC_DECODER)
	$(CC) $(PATH_OBJ_HUFFMAN) $(PATH_SRC_DECODER) -o $(PATH_EXE_DECODER) $(CFLAGS) $(CFLAGS2)
	
$(EXE_TDD): $(PATH_EXE_TDD)
$(PATH_EXE_TDD): $(PATH_OBJ_HUFFMAN) $(PATH_SRC_TDD)
	$(CC) $(PATH_OBJ_HUFFMAN) $(PATH_SRC_TDD) -o $(PATH_EXE_TDD) $(CFLAGS)
	
clean:
	$(RM) -rf $(PATH_OBJ_HUFFMAN) $(PATH_EXE_ENCODER)* $(PATH_EXE_DECODER)* $(PATH_EXE_TDD)*
